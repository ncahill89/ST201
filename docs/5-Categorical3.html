<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Niamh Cahill (she/her)">

<title>ST201 Data Analysis ‚Äì Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#considering-associations-with-two-categorical-variables" id="toc-considering-associations-with-two-categorical-variables" class="nav-link active" data-scroll-target="#considering-associations-with-two-categorical-variables">Considering associations with &gt; two categorical variables</a></li>
  <li><a href="#example-scenario-medical-treatment-success-rates" id="toc-example-scenario-medical-treatment-success-rates" class="nav-link" data-scroll-target="#example-scenario-medical-treatment-success-rates">Example Scenario: Medical Treatment Success Rates</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  </ul></li>
  <li><a href="#overall-success-rates-ignoring-hospital" id="toc-overall-success-rates-ignoring-hospital" class="nav-link" data-scroll-target="#overall-success-rates-ignoring-hospital">Overall Success Rates (ignoring hospital)</a></li>
  <li><a href="#success-rates-for-treatment-by-hospital" id="toc-success-rates-for-treatment-by-hospital" class="nav-link" data-scroll-target="#success-rates-for-treatment-by-hospital">Success Rates for Treatment by Hospital</a></li>
  <li><a href="#odds-and-odds-ratio" id="toc-odds-and-odds-ratio" class="nav-link" data-scroll-target="#odds-and-odds-ratio">Odds and Odds Ratio</a>
  <ul class="collapse">
  <li><a href="#what-are-odds" id="toc-what-are-odds" class="nav-link" data-scroll-target="#what-are-odds">üîç What Are Odds?</a></li>
  <li><a href="#what-is-the-odds-ratio" id="toc-what-is-the-odds-ratio" class="nav-link" data-scroll-target="#what-is-the-odds-ratio">üîó What is the Odds Ratio?</a></li>
  </ul></li>
  <li><a href="#example-student-admissions-at-uc-berkeley" id="toc-example-student-admissions-at-uc-berkeley" class="nav-link" data-scroll-target="#example-student-admissions-at-uc-berkeley">Example: Student Admissions at UC Berkeley</a></li>
  <li><a href="#example-student-admissions-at-uc-berkeley-1" id="toc-example-student-admissions-at-uc-berkeley-1" class="nav-link" data-scroll-target="#example-student-admissions-at-uc-berkeley-1">Example: Student Admissions at UC Berkeley</a></li>
  <li><a href="#example-student-admissions-at-uc-berkeley-2" id="toc-example-student-admissions-at-uc-berkeley-2" class="nav-link" data-scroll-target="#example-student-admissions-at-uc-berkeley-2">Example: Student Admissions at UC Berkeley</a></li>
  <li><a href="#example-student-admissions-at-uc-berkeley-3" id="toc-example-student-admissions-at-uc-berkeley-3" class="nav-link" data-scroll-target="#example-student-admissions-at-uc-berkeley-3">Example: Student Admissions at UC Berkeley</a></li>
  <li><a href="#example-student-admissions-at-uc-berkeley-4" id="toc-example-student-admissions-at-uc-berkeley-4" class="nav-link" data-scroll-target="#example-student-admissions-at-uc-berkeley-4">Example: Student Admissions at UC Berkeley</a></li>
  <li><a href="#whats-going-on" id="toc-whats-going-on" class="nav-link" data-scroll-target="#whats-going-on">What‚Äôs going on?</a></li>
  <li><a href="#lurking-variable" id="toc-lurking-variable" class="nav-link" data-scroll-target="#lurking-variable">Lurking Variable</a></li>
  <li><a href="#visualisation-2-way-mosaic-plots" id="toc-visualisation-2-way-mosaic-plots" class="nav-link" data-scroll-target="#visualisation-2-way-mosaic-plots">Visualisation: 2-way mosaic plots</a></li>
  <li><a href="#visualisation-3-way-mosaic-plots" id="toc-visualisation-3-way-mosaic-plots" class="nav-link" data-scroll-target="#visualisation-3-way-mosaic-plots">Visualisation: 3-way mosaic plots</a></li>
  <li><a href="#example-titanic-survival-data" id="toc-example-titanic-survival-data" class="nav-link" data-scroll-target="#example-titanic-survival-data">Example: Titanic Survival Data</a></li>
  <li><a href="#example-titanic-survival-data-1" id="toc-example-titanic-survival-data-1" class="nav-link" data-scroll-target="#example-titanic-survival-data-1">Example: Titanic Survival Data</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="5-Categorical3.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ST201 Data Analysis</h1>
<p class="subtitle lead">Association between Categorical Variables (3)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Niamh Cahill (she/her) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="considering-associations-with-two-categorical-variables" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="considering-associations-with-two-categorical-variables">Considering associations with &gt; two categorical variables</h2>
<p><strong>How do we consider associations with categorical data?</strong></p>
<ul>
<li>Visualisation</li>
<li>Proportions and Relative Risk</li>
<li>Odds and Odds Ratios</li>
</ul>
</section>
<section id="example-scenario-medical-treatment-success-rates" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="example-scenario-medical-treatment-success-rates">Example Scenario: Medical Treatment Success Rates</h2>
<p>Let‚Äôs consider two treatments, <strong>Treatment A</strong> and <strong>Treatment B</strong>, and their successes. Assume we also have information on where the treatments are carried out, either Hospital X or Hospital Y.</p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Hospital Treatment Patients Successes
1        X         A       10         5
2        X         B       90        30
3        Y         A       10         9
4        Y         B       90        60</code></pre>
</div>
</div>
<p><strong>Turning this data into contingency tables</strong></p>
<div class="cell" data-output-location="column-fragment">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb2-2"><a href="#cb2-2"></a>hospital_data<span class="sc">$</span>Failures <span class="ot">&lt;-</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  hospital_data<span class="sc">$</span>Patients <span class="sc">-</span>  hospital_data<span class="sc">$</span>Successes</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a>treatment_tab <span class="ot">&lt;-</span> </span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="fu">xtabs</span>(<span class="fu">cbind</span>(Successes, Failures) <span class="sc">~</span> Treatment, </span>
<span id="cb2-7"><a href="#cb2-7"></a>      <span class="at">data =</span> hospital_data)</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a>hospital_tab <span class="ot">&lt;-</span> </span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="fu">xtabs</span>(<span class="fu">cbind</span>(Successes, Failures)  <span class="sc">~</span> Hospital, </span>
<span id="cb2-11"><a href="#cb2-11"></a>      <span class="at">data =</span> hospital_data)</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a>treatment_tab;hospital_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         
Treatment Successes Failures
        A        14        6
        B        90       90</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        
Hospital Successes Failures
       X        35       65
       Y        69       31</code></pre>
</div>
</div>
</section>
</section>
<section id="overall-success-rates-ignoring-hospital" class="level2" style="font-size: 60%;">
<h2 style="font-size: 60%;" class="anchored" data-anchor-id="overall-success-rates-ignoring-hospital">Overall Success Rates (ignoring hospital)</h2>
<p>Let‚Äôs first compare the <strong>overall success rates</strong> for both treatments, ignoring the hospital.</p>
<ul>
<li>Given the format of this data we might deal with it a little differently in R than we‚Äôve seen before.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Calculate the overall success rate for Treatment A and B</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>overall_data <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(Patients, Successes) <span class="sc">~</span> Treatment, </span>
<span id="cb5-3"><a href="#cb5-3"></a>                      <span class="at">data =</span> hospital_data,</span>
<span id="cb5-4"><a href="#cb5-4"></a>                      <span class="at">FUN =</span> sum)</span>
<span id="cb5-5"><a href="#cb5-5"></a>overall_data<span class="sc">$</span>OverallSuccessRate <span class="ot">&lt;-</span> </span>
<span id="cb5-6"><a href="#cb5-6"></a>  overall_data<span class="sc">$</span>Successes <span class="sc">/</span> overall_data<span class="sc">$</span>Patients</span>
<span id="cb5-7"><a href="#cb5-7"></a>overall_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Treatment Patients Successes OverallSuccessRate
1         A       20        14                0.7
2         B      180        90                0.5</code></pre>
</div>
</div>
<ul>
<li>We can still visualise this, but the table is also sufficient.</li>
</ul>
<div class="cell" data-output-location="column-fragment">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">barplot</span>(overall_data<span class="sc">$</span>OverallSuccessRate, </span>
<span id="cb7-2"><a href="#cb7-2"></a>        <span class="at">names.arg =</span> overall_data<span class="sc">$</span>Treatment,</span>
<span id="cb7-3"><a href="#cb7-3"></a>        <span class="at">main =</span> <span class="st">"Overall Success Rates by Treatment"</span> ,</span>
<span id="cb7-4"><a href="#cb7-4"></a>        <span class="at">ylab =</span> <span class="st">"Overall Success Rate"</span>, </span>
<span id="cb7-5"><a href="#cb7-5"></a>        <span class="at">xlab =</span> <span class="st">"Treatment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5-Categorical3_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>. . .</p>
<p><strong>Treatment A</strong> has a higher success rate than <strong>Treatment B</strong>.</p>
</section>
<section id="success-rates-for-treatment-by-hospital" class="level2" style="font-size: 60%;">
<h2 style="font-size: 60%;" class="anchored" data-anchor-id="success-rates-for-treatment-by-hospital">Success Rates for Treatment by Hospital</h2>
<p>Now, let‚Äôs break down the success rates based on whether treatment was performed at Hospital X or Y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Calculate the overall success rate for Treatment A and B</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>hospital_data<span class="sc">$</span>SuccessRate <span class="ot">&lt;-</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  hospital_data<span class="sc">$</span>Successes <span class="sc">/</span> hospital_data<span class="sc">$</span>Patients</span>
<span id="cb8-4"><a href="#cb8-4"></a>hospital_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Hospital Treatment Patients Successes Failures SuccessRate
1        X         A       10         5        5   0.5000000
2        X         B       90        30       60   0.3333333
3        Y         A       10         9        1   0.9000000
4        Y         B       90        60       30   0.6666667</code></pre>
</div>
</div>
<ul>
<li>To visualise this with a barplot we need to manipulate the data a bit:</li>
</ul>
<div class="cell" data-output-location="column-fragment">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>hospital_tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(SuccessRate <span class="sc">~</span> Treatment <span class="sc">+</span> Hospital, </span>
<span id="cb10-2"><a href="#cb10-2"></a>                      <span class="at">data =</span> hospital_data)</span>
<span id="cb10-3"><a href="#cb10-3"></a>hospital_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Hospital
Treatment         X         Y
        A 0.5000000 0.9000000
        B 0.3333333 0.6666667</code></pre>
</div>
</div>
<div class="cell" data-output-location="column-fragment">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">barplot</span>(hospital_tab,</span>
<span id="cb12-2"><a href="#cb12-2"></a>        <span class="at">legend.text =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-3"><a href="#cb12-3"></a>        <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>        <span class="at">main =</span> <span class="st">"Success Rates by Treatment &amp; Hospital"</span> ,</span>
<span id="cb12-5"><a href="#cb12-5"></a>        <span class="at">ylab =</span> <span class="st">"Success Rate"</span>, </span>
<span id="cb12-6"><a href="#cb12-6"></a>        <span class="at">xlab =</span> <span class="st">"Hospital"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5-Categorical3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>. . .</p>
<p><strong>Treatment A</strong> has a higher success rate than <strong>Treatment B</strong> in both hospitals.</p>
</section>
<section id="odds-and-odds-ratio" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="odds-and-odds-ratio">Odds and Odds Ratio</h2>
<section id="what-are-odds" class="level3">
<h3 class="anchored" data-anchor-id="what-are-odds">üîç What Are Odds?</h3>
<p>When comparing two groups (e.g., Treatment vs.&nbsp;Control), the <em>odds of success</em> for each are calculated by:</p>
<ul>
<li><p><strong>Category 1</strong>:<br>
<span class="math inline">\(w1 = \frac{\text{Success in Group 1}}{\text{Failure in Group 1}}\)</span></p></li>
<li><p><strong>Category 2</strong>:<br>
<span class="math inline">\(w2 = \frac{\text{Success in Group 2}}{\text{Failure in Group 2}}\)</span></p></li>
</ul>
</section>
<section id="what-is-the-odds-ratio" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-odds-ratio">üîó What is the Odds Ratio?</h3>
<p>The <em>odds ratio</em> tells us how much more likely success odds are in one group compared to the other:</p>
<p><span class="math inline">\(\text{Odds Ratio} = \frac{w1}{w2}\)</span></p>
</section>
</section>
<section id="example-student-admissions-at-uc-berkeley" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="example-student-admissions-at-uc-berkeley">Example: Student Admissions at UC Berkeley</h2>
<p>Aggregate data on applicants to graduate school at Berkeley for the six largest departments in 1973 classified by admission and sex.</p>
<p>The variables and their levels are as follows:</p>
<ol type="1">
<li><p>Admit: Admitted, Rejected</p></li>
<li><p>Gender: Male, Female</p></li>
<li><p>Dept: A, B, C, D, E, F</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>admission_dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,526 √ó 3
   admit    gender dept 
   &lt;fct&gt;    &lt;fct&gt;  &lt;ord&gt;
 1 Admitted Male   A    
 2 Admitted Male   A    
 3 Admitted Male   A    
 4 Admitted Male   A    
 5 Admitted Male   A    
 6 Admitted Male   A    
 7 Admitted Male   A    
 8 Admitted Male   A    
 9 Admitted Male   A    
10 Admitted Male   A    
# ‚Ñπ 4,516 more rows</code></pre>
</div>
</div>
</section>
<section id="example-student-admissions-at-uc-berkeley-1" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="example-student-admissions-at-uc-berkeley-1">Example: Student Admissions at UC Berkeley</h2>
<p>Let‚Äôs assume, upon an initial look at the data, that the tables are collapsed over department.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> gender <span class="sc">+</span> admit, <span class="at">data =</span> admission_dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        admit
gender   Admitted Rejected
  Female      557     1278
  Male       1198     1493</code></pre>
</div>
</div>
<p>. . .</p>
<p><strong>Odds</strong></p>
<div class="cell" data-output-location="column-fragment">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>admission_odds <span class="ot">&lt;-</span> <span class="fu">lodds</span>(<span class="sc">~</span>  admit <span class="sc">+</span> gender, </span>
<span id="cb17-2"><a href="#cb17-2"></a>                        <span class="at">data =</span> admission_dat, </span>
<span id="cb17-3"><a href="#cb17-3"></a>                        <span class="at">log =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="fu">coef</span>(admission_odds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Admitted:Rejected|Female   Admitted:Rejected|Male 
               0.4358372                0.8024113 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">confint</span>(admission_odds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             2.5 %    97.5 %
Admitted:Rejected|Female 0.3945546 0.4814394
Admitted:Rejected|Male   0.7436704 0.8657919</code></pre>
</div>
</div>
<p>. . .</p>
<p><strong>and Odds Ratios</strong></p>
<div class="cell" data-output-location="column-fragment">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>admission_OR <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(<span class="sc">~</span>  admit <span class="sc">+</span> gender, </span>
<span id="cb21-2"><a href="#cb21-2"></a>                           <span class="at">data =</span> admission_dat, </span>
<span id="cb21-3"><a href="#cb21-3"></a>                           <span class="at">log =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="fu">coef</span>(admission_OR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Admitted:Rejected/Female:Male 
                    0.5431594 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">confint</span>(admission_OR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  2.5 %    97.5 %
Admitted:Rejected/Female:Male 0.4792272 0.6156207</code></pre>
</div>
</div>
<!-- - **Category 1 - Female**:   -->
<!--   $w1 = \frac{\text{Success in Female Group}}{\text{Failure in Female Group}}$ -->
<!-- - **Category 2 - Male**:   -->
<!--   $w2 = \frac{\text{Success in Male Group}}{\text{Failure in Male Group}}$ -->
<!-- - $\text{Odds Ratio} = \frac{w1}{w2}$ -->
</section>
<section id="example-student-admissions-at-uc-berkeley-2" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="example-student-admissions-at-uc-berkeley-2">Example: Student Admissions at UC Berkeley</h2>
<p>Let us look at the same data but divided into groups by department.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>admission_tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> gender <span class="sc">+</span> admit <span class="sc">+</span> dept, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> admission_dat)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(admission_tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , dept = A

        admit
gender   Admitted Rejected  Sum
  Female       89       19  108
  Male        512      313  825
  Sum         601      332  933

, , dept = B

        admit
gender   Admitted Rejected  Sum
  Female       17        8   25
  Male        353      207  560
  Sum         370      215  585

, , dept = C

        admit
gender   Admitted Rejected  Sum
  Female      202      391  593
  Male        120      205  325
  Sum         322      596  918

, , dept = D

        admit
gender   Admitted Rejected  Sum
  Female      131      244  375
  Male        138      279  417
  Sum         269      523  792

, , dept = E

        admit
gender   Admitted Rejected  Sum
  Female       94      299  393
  Male         53      138  191
  Sum         147      437  584

, , dept = F

        admit
gender   Admitted Rejected  Sum
  Female       24      317  341
  Male         22      351  373
  Sum          46      668  714

, , dept = Sum

        admit
gender   Admitted Rejected  Sum
  Female      557     1278 1835
  Male       1198     1493 2691
  Sum        1755     2771 4526</code></pre>
</div>
</div>
</section>
<section id="example-student-admissions-at-uc-berkeley-3" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="example-student-admissions-at-uc-berkeley-3">Example: Student Admissions at UC Berkeley</h2>
<p><strong>Odds</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>admission_odds <span class="ot">&lt;-</span> <span class="fu">lodds</span>(<span class="sc">~</span>  admit <span class="sc">+</span> gender <span class="sc">+</span> dept, <span class="at">data =</span> admission_dat, </span>
<span id="cb27-2"><a href="#cb27-2"></a>                        <span class="at">log =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="fu">coef</span>(admission_odds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Admitted:Rejected|Female:A   Admitted:Rejected|Male:A 
                4.68421053                 1.63578275 
Admitted:Rejected|Female:B   Admitted:Rejected|Male:B 
                2.12500000                 1.70531401 
Admitted:Rejected|Female:C   Admitted:Rejected|Male:C 
                0.51662404                 0.58536585 
Admitted:Rejected|Female:D   Admitted:Rejected|Male:D 
                0.53688525                 0.49462366 
Admitted:Rejected|Female:E   Admitted:Rejected|Male:E 
                0.31438127                 0.38405797 
Admitted:Rejected|Female:F   Admitted:Rejected|Male:F 
                0.07570978                 0.06267806 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">confint</span>(admission_odds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                2.5 %     97.5 %
Admitted:Rejected|Female:A 2.85443740 7.68691870
Admitted:Rejected|Male:A   1.42119020 1.88277768
Admitted:Rejected|Female:B 0.91708435 4.92389276
Admitted:Rejected|Male:B   1.43644040 2.02451551
Admitted:Rejected|Female:C 0.43593215 0.61225216
Admitted:Rejected|Male:C   0.46729337 0.73327208
Admitted:Rejected|Female:D 0.43419451 0.66386323
Admitted:Rejected|Male:D   0.40335753 0.60654021
Admitted:Rejected|Female:E 0.24934640 0.39637863
Admitted:Rejected|Male:E   0.27979716 0.52716949
Admitted:Rejected|Female:F 0.04999699 0.11464631
Admitted:Rejected|Male:F   0.04074158 0.09642579</code></pre>
</div>
</div>
</section>
<section id="example-student-admissions-at-uc-berkeley-4" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="example-student-admissions-at-uc-berkeley-4">Example: Student Admissions at UC Berkeley</h2>
<p><strong>and Odds Ratios</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>admission_OR <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(<span class="sc">~</span>  admit <span class="sc">+</span> gender <span class="sc">+</span> dept, <span class="at">data =</span> admission_dat, </span>
<span id="cb31-2"><a href="#cb31-2"></a>                        <span class="at">log =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="fu">coef</span>(admission_OR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        A         B         C         D         E         F 
2.8635896 1.2461048 0.8825661 1.0854419 0.8185776 1.2079151 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">confint</span>(admission_OR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %   97.5 %
A 1.7111703 4.792127
B 0.5285366 2.937880
C 0.6656152 1.170230
D 0.8086284 1.457016
E 0.5528574 1.212011
F 0.6641723 2.196808</code></pre>
</div>
</div>
</section>
<section id="whats-going-on" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="whats-going-on">What‚Äôs going on?</h2>
<p>In this example, <strong>Simpson‚Äôs Paradox</strong> has occurred because</p>
<ul>
<li><p>both gender identity and admissions were related to a third variable, namely, the department.</p></li>
<li><p>First, women were more likely to apply to social science departments, whereas men were more likely to apply to natural science departments.</p></li>
<li><p>Second, the acceptance rate in social science departments was less than that in natural science departments.</p></li>
</ul>
<p>Because women were more likely than men to apply to programs with lower acceptance rates, when department was ignored (i.e., when the data were aggregated over dept), it seemed that women were less likely than men to be admitted to graduate school, whereas the reverse was actually true.</p>
</section>
<section id="lurking-variable" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="lurking-variable">Lurking Variable</h2>
<p>A lurking variable is a variable that is not included as an explanatory variable in the analysis but can affect the interpretation of relationships between variables.</p>
<ul>
<li><p>A lurking variable can falsely identify a strong relationship between variables or it can hide the true relationship.</p></li>
<li><p>To discover lurking variables, you must take the time to understand your data and the important variables that can affect a process.</p></li>
</ul>
<p>Ignoring an important lurking variable can lead to <strong>Simpson‚Äôs Paradox</strong>, especially when analyzing <strong>categorical data</strong>. This paradox occurs when the relationship between two variables reverses or changes after considering a third variable.</p>
</section>
<section id="visualisation-2-way-mosaic-plots" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="visualisation-2-way-mosaic-plots">Visualisation: 2-way mosaic plots</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5-Categorical3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(<span class="sc">~</span> gender <span class="sc">+</span> admit, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> admission_dat, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="visualisation-3-way-mosaic-plots" class="level2" style="font-size: 60%;">
<h2 style="font-size: 60%;" class="anchored" data-anchor-id="visualisation-3-way-mosaic-plots">Visualisation: 3-way mosaic plots</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5-Categorical3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(<span class="sc">~</span> dept <span class="sc">+</span> gender <span class="sc">+</span> admit , </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> admission_dat, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="example-titanic-survival-data" class="level2" style="font-size: 50%;">
<h2 style="font-size: 50%;" class="anchored" data-anchor-id="example-titanic-survival-data">Example: Titanic Survival Data</h2>
<p>This data set provides information on the fate of passengers on the fatal maiden voyage of the ocean liner ‚ÄòTitanic‚Äô, summarized according to economic status (class), sex, age and survival.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-cd89cc49d9036af950a8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cd89cc49d9036af950a8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32"],["1st","2nd","3rd","Crew","1st","2nd","3rd","Crew","1st","2nd","3rd","Crew","1st","2nd","3rd","Crew","1st","2nd","3rd","Crew","1st","2nd","3rd","Crew","1st","2nd","3rd","Crew","1st","2nd","3rd","Crew"],["Male","Male","Male","Male","Female","Female","Female","Female","Male","Male","Male","Male","Female","Female","Female","Female","Male","Male","Male","Male","Female","Female","Female","Female","Male","Male","Male","Male","Female","Female","Female","Female"],["Child","Child","Child","Child","Child","Child","Child","Child","Adult","Adult","Adult","Adult","Adult","Adult","Adult","Adult","Child","Child","Child","Child","Child","Child","Child","Child","Adult","Adult","Adult","Adult","Adult","Adult","Adult","Adult"],["No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes"],[0,0,35,0,0,0,17,0,118,154,387,670,4,13,89,3,5,11,13,0,1,13,14,0,57,14,75,192,140,80,76,20]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Class<\/th>\n      <th>Sex<\/th>\n      <th>Age<\/th>\n      <th>Survived<\/th>\n      <th>Freq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":5},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Class","targets":1},{"name":"Sex","targets":2},{"name":"Age","targets":3},{"name":"Survived","targets":4},{"name":"Freq","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="example-titanic-survival-data-1" class="level2" style="font-size: 70%;">
<h2 style="font-size: 70%;" class="anchored" data-anchor-id="example-titanic-survival-data-1">Example: Titanic Survival Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(Freq <span class="sc">~</span> Sex <span class="sc">+</span> Survived , <span class="at">data =</span> titanic_df )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Survived
Sex       Yes   No
  Male    367 1364
  Female  344  126</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(Freq <span class="sc">~</span> <span class="sc">+</span> Sex <span class="sc">+</span> Survived <span class="sc">+</span> Class, <span class="at">data =</span> titanic_df )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , Class = 1st

        Survived
Sex      Yes  No
  Male    62 118
  Female 141   4

, , Class = 2nd

        Survived
Sex      Yes  No
  Male    25 154
  Female  93  13

, , Class = 3rd

        Survived
Sex      Yes  No
  Male    88 422
  Female  90 106

, , Class = Crew

        Survived
Sex      Yes  No
  Male   192 670
  Female  20   3</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>